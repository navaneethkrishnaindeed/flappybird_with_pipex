name: Simple Test - Download PipeX Package 200 Times

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  download-pipex-test:
    name: Download PipeX Package from pub.dev 200 Times
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'
      
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.27.1'
          channel: 'stable'
          cache: true
      
      - name: Check Flutter Version
        run: |
          echo "=== Flutter Version ==="
          flutter --version
          echo ""
          echo "=== Dart Version ==="
          dart --version
      
      - name: Download PipeX Package 200 Times
        run: |
          echo "Starting to download pipe_x package 200 times..."
          echo "Package URL: https://pub.dev/api/archives/pipe_x-1.4.4.tar.gz"
          echo ""
          
          for i in {1..200}
          do
            echo "========================================="
            echo "Download Attempt #$i of 200"
            echo "========================================="
            
            # Download pipe_x package directly from pub.dev
            echo "üì¶ Downloading pipe_x-1.4.4.tar.gz..."
            curl -L -o pipe_x-1.4.4.tar.gz https://pub.dev/api/archives/pipe_x-1.4.4.tar.gz
            
            echo "üìä Download size:"
            ls -lh pipe_x-1.4.4.tar.gz
            
            # Clean up downloaded file
            rm -f pipe_x-1.4.4.tar.gz
            
            # Clean Flutter cache and everything
            echo "üßπ Cleaning Flutter cache..."
            flutter pub cache clean --force
            flutter clean
            rm -rf .dart_tool
            rm -f pubspec.lock
            rm -rf build
            
            echo "‚úÖ Download #$i completed successfully!"
            echo "‚è≥ Waiting 5 seconds before next download..."
            sleep 5
            echo ""
          done
          
          echo "========================================="
          echo "üéâ All 200 downloads completed!"
          echo "========================================="
      
      - name: Final Summary
        run: |
          echo "=== Final Summary ==="
          echo "‚úÖ Successfully downloaded pipe_x-1.4.4.tar.gz 200 times"
          echo "‚úÖ Cleaned Flutter cache 200 times"
          echo "‚è±Ô∏è Total time with 5 second delays: ~200 downloads"
          echo "üì¶ Package URL: https://pub.dev/api/archives/pipe_x-1.4.4.tar.gz"

